import Latex from "react-latex-next";
import StorageCostChart from "@/components/StorageCostChart";

# Pricing Model

This outlines the protocol mechanism that enables users to pay an up-front one-time fee for decentralized data storage. The mechanism aims to provide users with a stable and predictable storage price, ensuring that the fee is sufficient to sustainably fund storage costs long-term, without relying on a central authority.

## The Problem

Networked storage is a commodity in today's cloud services market, with intense competition driving prices close to the physical cost of providing storage. Centralized storage providers benefit from stable fiat currencies and payment rails to price their services at a fixed rate. However, decentralized storage networks must price their services using native tokens, which are subject to the volatility of cryptocurrencies. This presents a challenge in maintaining stable and competitive pricing for users, as the cost of storage may fluctuate significantly due to token volatility. Decentralized storage networks need to develop innovative pricing mechanisms to address this issue and ensure predictable and competitive costs for their users.

## Pricing Mechanisms

The decentralized storage space has established a few approaches to addressing the pricing dilemma of maintaining a stable cost in a volatile currency. Irys maintains stable pricing through an innovative method of tracking the USD/$IRYS price at the rate of block production, ensuring costs remain close to the actual storage expenses

### Irys

Irys employs a pay up front one-time fee model which simplifies the development and deployment of onchain applications. However, Irys tracks the $IRYS token price differently. Miners include the current USD/$IRYS price in the blocks they produce, and as long as these price quotes are within a reasonable range, other miners accept the block. This method allows the protocol to track the $IRYS price at the rate of block production. Consequently, Irys pricing remains close to the physical cost of storing data.
The protocol assumes a fixed pricing model for the current annual cost of storing a partition's worth (16TB) of data and projects a 1% annual decline in storage costs. By using an exponential moving average of the $IRYS token price recorded in block headers, the protocol maintains a stable USD storage price regardless of the current $IRYS price.

### Arweave

Arweave also employs an up front pay-once-store-forever model. Users pay a one-time fee, with 95% allocated to an endowment that rewards miners over time. The network adjusts prices based on miner participation relative to the dataset size. When there are too many miners, the price of storage decreases, encouraging some miners to leave; when there are too few miners, prices increase to attract more participants.
A limitation of Arweave’s model is that storage prices adjust based on the rate of miners joining and leaving, which isn’t solely determined by the token price. High upfront costs make it difficult for miners to leave quickly when the token price drops.

### Filecoin

Filecoin takes a market-driven approach, where storage providers commit capacity to the protocol and offer it at rates that cover their costs and profit margins. Providers compete on price, and users select the most suitable offer to create a storage deal.
This approach has limitations, such as the restricted duration of storage deals (180-540 days on Filecoin). Longer-term storage requires renegotiating deals upon expiration, as technological advancements and market forces may significantly reduce storage costs over time. To account for these changes, there is a limit on how far in advance users can pay for storage.

## Irys Pricing

### Key Factors:

To determine the baseline amount of USD it costs to store data, Irys relies on the following factors.

1. **Annualized Cost Assessment**: Pricing is anchored in an accurate assessment of the current annualized cost of storing data, denominated in USD. This assessment takes into account factors such as hardware costs, power consumption, and drive failure rates.
2. **Future Cost Projection**: A conservative and safe model is used to project future storage costs over an extended period based on the current annualized cost. The model assumes a modest 1% annual decay rate in storage costs, allowing for a wide safety margin when it comes to future technological advancements and market conditions.
3. **$IRYS Token Price**: The protocol provides the ability to quote the price of storage in the native $IRYS token. This is achieved by maintaining an approximate USD/$IRYS exchange rate and adjusting the $IRYS price based on the projected USD storage cost.

### Protocol Mechanisms:

During operation, Irys periodically makes adjustments to its pricing using two mechanisms.

1. **$IRYS Token Price Approximation**: The protocol includes a reliable mechanism to approximate the current USD price of the $IRYS token. This is achieved through a mechanism similar to the one used to track time for difficulty adjustments in PoW blockchains. The determined price is used to set the one-time storage fee in $IRYS tokens, ensuring users pay a consistent USD-equivalent amount.
2. **Annualized Cost Adjustment**: This system updates the annual cost of storing data based on current market conditions and new technology. About once a year, there’s a 2-week period when miners post their annual costs in the blocks they create. At the end of this period, the median cost is used to set prices for the next year. Without these updates, the protocol would overcharge due to safety margins in its pricing model.

### Pricing Model:

The pricing model for the future cost of storage is based on a fixed model, defined by the following parameters. Of the three, only the Annualized Cost of Storing 1GB is updated from year to year.

1. **Annualized Cost of Storing 1GB**: The pricing model uses the annualized cost of storing 1GB, as determined by the pricing parameter, as its starting point.
2. **Annualized Decay Rate**: The model assumes a conservative 1% annual decay rate in storage costs, accounting for a wide range potential improvements in technology and market efficiency over time.
3. **Safe Minimum Number of Years**: The pricing model calculates the one-time storage fee based on a safe minimum number of years, initially set to 200 years. This ensures that the fee charged is sufficient to cover storage costs for an extended period, providing peace of mind to users. The safety margins baked into the pricing model mean that in all but the very worst of outcomes the network can afford to pay for storage many multiples of 200 years into the future.

### Pricing Parameters:

These are parameters the protocol manages to adjust pricing over time.

1. **Annualized Cost of Storing 1GB:** The current annualized cost of storing 1GB of data, denominated in USD, is maintained as a protocol parameter. This parameter is used as the basis for the pricing model and is adjusted periodically through hard forks.
2. **Approximate USD/$IRYS Price**: The protocol maintains an approximate USD/$IRYS exchange rate as a parameter. This rate is updated dynamically using the price adjustment interval mechanism, ensuring that storage prices remain stable in USD terms.

## Irys Pricing Model

### Annualized Storage Cost

The annualized cost of storing 1GB of data is determined by several contributing factors:

- Upfront cost of purchasing a storage drive
- The storage capacity of the drive in GB
- The annualized failure rate of the drive
- Power consumption of the drive under expected workloads
- Cost of power

For the purpose of this specification, we will consider a representative 16TB drive typically found in datacenter workloads in 2024.

To calculate the annual power consumption, we take into account the mining workload, the expected time the drive spends reading data versus idling, its power efficiency in converting AC to DC power, and the hours of operation in a year.

<div className="mt-5 break-normal w-full text-xs border border-gray-400">
	<div className="grid grid-cols-10 border-b bg-slate-800">
		<div className="col-span-1 border-r">Operation</div>
		<div className="col-span-1 border-r">Operation Power Consumpt- ion</div>
		<div className="col-span-1 border-r">Power Efficiency</div>
		<div className="col-span-1 border-r">Transfer Rate (Reads)</div>
		<div className="col-span-1 border-r">AC Power Consumpt- ion</div>
		<div className="col-span-1 border-r">Operation Annual Share</div>
		<div className="col-span-1 border-r">Hours in a Year</div>
		<div className="col-span-1 border-r">Hours of Operation per year</div>
		<div className="col-span-1 border-r">Hours Per Day</div>
		<div className="col-span-1 border-r">Annual HDD AC Power Consumpt- ion</div>
	</div>
	<div className="grid grid-cols-10 border-b">
		<div className="col-span-1 border-r">R/W</div>
		<div className="col-span-1 border-r">6.50W</div>
		<div className="col-span-1 border-r">0.7</div>
		<div className="col-span-1 border-r">269MB/s</div>
		<div className="col-span-1 border-r">9.29W</div>
		<div className="col-span-1 border-r">80%</div>
		<div className="col-span-1 border-r">8760</div>
		<div className="col-span-1 border-r">7008</div>
		<div className="col-span-1 border-r">19.20 hr</div>
		<div className="col-span-1 border-r">65.07kWh</div>
	</div>
	<div className="grid grid-cols-10 border-b">
		<div className="col-span-1 border-r">Idle</div>
		<div className="col-span-1 border-r">5.60W</div>
		<div className="col-span-1 border-r">0.7</div>
		<div className="col-span-1 border-r">-</div>
		<div className="col-span-1 border-r">8.00W</div>
		<div className="col-span-1 border-r">20%</div>
		<div className="col-span-1 border-r">8760</div>
		<div className="col-span-1 border-r">1752</div>
		<div className="col-span-1 border-r">4.80 hr</div>
		<div className="col-span-1 border-r">14.02kWh</div>
	</div>
	<div className="grid grid-cols-10 border-b">
		<div className="col-span-7"></div>
		<div className="col-span-2 border-r text-right pr-2">Total Annual AC Consumption</div>
		<div className="col-span-1 border-r">79.09kWh</div>
	</div>
	<div className="grid grid-cols-10 border-b border-gray-400">
		<div className="col-span-7"></div>
		<div className="col-span-2 border-r text-right pr-2">Total Annual Data Transferred</div>
		<div className="col-span-1 border-r">6,472TiB</div>
	</div>
	<div className="grid grid-cols-10 border-gray-400 bg-slate-800">
		<div className="col-span-1 border-r"></div>
		<div className="col-span-1 border-r">Annualized Failure Rate</div>
		<div className="col-span-1 border-r">Drive Price</div>
		<div className="col-span-1 border-r">Drives In Datacenter</div>
		<div className="col-span-1 border-r">Drives Replaced</div>
		<div className="col-span-1 border-r">Replace- ment Costs</div>
		<div className="col-span-1 border-r">Annual kWh Consumed</div>
		<div className="col-span-1 border-r">Annual Energy Cost</div>
		<div className="col-span-1 border-r">Annual Operation Expenses</div>
		<div className="col-span-1 border-r">Annual Cost Per Drive</div>
	</div>
	<div className="grid grid-cols-10 border-b border-t border-gray-400">
		<div className="col-span-1 border-r">Annualized cost</div>
		<div className="col-span-1 border-r">1.40%</div>
		<div className="col-span-1 border-r">$169.99</div>
		<div className="col-span-1 border-r">100</div>
		<div className="col-span-1 border-r">1.4</div>
		<div className="col-span-1 border-r">$237.99</div>
		<div className="col-span-1 border-r">7,909kWh</div>
		<div className="col-span-1 border-r">$1,001</div>
		<div className="col-span-1 border-r">$18,238</div>
		<div className="col-span-1 border-r">$182</div>
	</div>
	<div className="grid grid-cols-10 border-gray-400">
		<div className="col-span-8"></div>
		<div className="col-span-1 border-r text-right pr-2">Cost of Power</div>
		<div className="col-span-1">12.66 ¢/kWh</div>
	</div>
</div>

By combining the annualized power consumption with the annualized HDD failure rate (as reported by [BackBlaze](https://www.backblaze.com/blog/backblaze-drive-stats-for-q1-2023/)), the current drive price, and the cost of power (which is readily available in most developed countries), we arrive at the annualized cost of operating a representative HDD storing data on the network.

Based on these factors, the annualized cost of mining and operating a 16TB drive is estimated to be $182. Given that a 16TB drive contains 16,384GB, the annualized cost of storing 1GB is calculated as follows:

<div className="flex flex-col justify-center items-center mt-5">
	<div className="flex flex-col justify-center border border-gray-400 px-10">
		<p className="px-4 py-2 bg-slate-800 w-full flex justify-center"> Annualized cost per GB</p>
		<Latex className="-mb-2">{`$$\\text{Cost to store 16TB} = \\$182$$`}</Latex>
		<Latex className="-mb-2">{`$$16TB = 16,384GB$$`}</Latex>
		<Latex>{`$$\\$182 \\div 16,384 = \\$0.01110839844$$`}</Latex>
	</div>
</div>

This annualized cost per GB will serve as a key input for the permanent storage pricing model.

## Annualized Decay Rate

The **decay rate** represents the annual decrease in storage costs due to technological advancements. Historically, storage density improvements have followed an exponential trend, as described by <a className="underline decoration-dashed" id="kryders-law">Kryder's Law</a>, which outpaced <a className="underline decoration-dashed" id="moores-law">Moore's Law</a> in the early 2000s. Although the rate of improvement has slowed in recent years, it still remains significant at around 28% annually.

To ensure the pricing model is both accessible and sustainable, Irys assumes a conservative 1% average annual decline in storage costs over the next 200 years. This approach allows for the extension of the purchasing power of the upfront payment in the event that observed (actual) storage cost declines exceed the assumed rate.

This leads to the following exponential decay formula to determine the cost of storing a single copy of 1GB of data over the next 200 years.

<div className="mt-5">
	<div className="grid grid-cols-[1fr_6fr_6fr] gap-2 border border-gray-400 p-4 ">
		<div className="col-span-3 px-4 py-2 bg-slate-800 text-white">
			<Latex>{`$$\\text{Total Cost} = C_0 \\times \\left( \\frac{1 - (1 - \\text{decay rate})^n}{\\text{decay rate}} \\right)$$`}</Latex>
		</div>
		<div className="col-span-3 px-4 py-2 text-white ">
			<div>**C0​** = the initial annual cost of storing 1 GB.</div>
			<div>**decay rate** = the annual rate of decline in storage costs.</div>
			<div>**n** = the number of years of safe minimum time.</div>
		</div>
		<div className="col-span-3 px-4 py-2 text-white ">
			<StorageCostChart />
		</div>
	</div>
</div>

## Safe Minimum Time

The safe minimum time is a crucial concept in the permanent storage pricing model, as it represents the fixed period for which users pay to store their data. Determining an appropriate safe minimum time involves considering several key factors:

1. **Minimum Number of Replicas**: To ensure fault tolerance and data durability, the protocol must maintain a minimum number of data replicas. The safe minimum time should be sufficient to cover the storage costs for these replicas.
2. **Years of Storage**: The protocol must determine the number of years for which miners should be paid to maintain the data replicas. This duration should be long enough to provide users with confidence in the permanence of their data.
3. **Safety Margins**: The pricing model incorporates safety margins to account for potential fluctuations in storage costs and other uncertainties. These margins help ensure that the upfront payment remains sufficient to cover storage costs over the safe minimum time.
4. **Storage Cost Declines**: The pricing model takes into account the expected declines in storage costs over time due to technological advancements. By assuming a conservative rate of decline, the model ensures that the safe minimum time remains viable even if cost reductions slow down.

The interplay of these factors results in a safe minimum time that provides users with a high degree of assurance that their data will remain permanently stored. Any declines in storage costs that exceed the conservative assumptions of the pricing model will effectively extend the duration for which the upfront payment can fund storage. In most cases, this results in a storage term that can span thousands of years, further reinforcing the permanence of the data stored on the protocol.

## Irys Protocol Mechanisms

The pricing model, although fixed and deterministically calculable, relies on two independent (or external) variables: the annual cost of storing 1 GB in any given year and the current USD/$IRYS price. To account for these externalities, the protocol employs the following mechanisms:

### Price Adjustment Interval

Like Bitcoin and other PoW chains, Irys utilizes an Adjustment Interval to track factors external to the chain. In PoW chains, this mechanism is used to track the passage of time, which is independent of block production. Each block includes a timestamp that must fall within a given range of possible times to be considered valid. In Bitcoin's case, a Difficulty adjustment occurs every 2016 blocks (roughly 14 days). During this adjustment, the protocol examines the time taken to produce the last 2016 blocks and compares it to the expected time. Based on this delta, the network's difficulty setting is adjusted higher or lower to increase or decrease the average block production time. This timekeeping mechanism is crucial, as a consistent block time is how the protocol manages its monetary policy around token emissions.

Irys employs a similar Adjustment Interval mechanism to track the USD/$IRYS price, which is external to the protocol. The Adjustment Interval for $IRYS price tracking occurs approximately once every hour (measured in blocks). At each interval, the protocol calculates the Exponential Moving Average (EMA) of the USD/$IRYS prices recorded in the blocks over the last 8 adjustment intervals, giving more weight to recent prices. The EMA smooths out price volatility while prioritizing recent data, providing a balance between protection from volatility and accuracy.

The price adjustment is constrained to fall within a range of +/- 0.25% to 5% to balance responsiveness and volatility mitigation. The new $IRYS price takes effect at the block height of the next Adjustment Interval, providing miners with a full interval to prepare for the change and quote the correct storage price to users.

Unlike tracking timestamps, which are relatively predictable and reliable once a computer's clock is configured, tracking the USD price of $IRYS introduces an element of risk for block producers, as they must rely on external parties to report the token price.

To mitigate these risks, the protocol employs several mechanisms:

1. **Safe Ranges for Price Fluctuations**: The protocol defines safe ranges within which the reported $IRYS price must fall to be considered valid.
2. **Vote of Confidence**: Block producers express their confidence in the current $IRYS price by simply including current EMA price in the blocks they produce (no need for external oracles).
3. **External Price Oracles**: Block producers can select from one or more external price oracles for $IRYS and post prices within the predefined safe ranges.
4. **Irys Foundation Oracle**: Block producers have the option to subscribe to the $IRYS price provided by the Irys Foundation's oracle.

By incorporating these risk mitigation mechanisms, the protocol ensures that the $IRYS token can experience price volatility while maintaining a relatively stable USD price for storage.
