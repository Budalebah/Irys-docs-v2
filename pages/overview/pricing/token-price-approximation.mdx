---
description:
---

import Latex from "react-latex-next";
import { EmaTooltip } from "@/tooltips/Tooltips";

<EmaTooltip />

# Token Price Approximation

Given the following Token Price Adjustment parameters:

| Parameter           | Value               |
| ------------------- | ------------------- |
| Block time          | ~2min               |
| Adjustment Interval | 10 blocks (~20 min) |
| Genesis Token Price | $1.00 (for example) |

![](/diagrams/overview/token-price-adustments.png)

1. For the first two **Adjustment Intervals**, the protocol uses the Genesis token price for fee calculations.
2. At the end of the first **Adjustment Interval** (block height 9), the protocol calculates the <a className="underline decoration-dashed" id="ema">Exponential Moving Average (EMA)</a> starting with the genesis block price. It records the resulting value E9 in its block header.
3. This EMA (E9) is the Token price used for fee calculations starting on block height 20.
4. From this point forward, at the end of each Adjustment Interval, the protocol continues the EMA calculation from the token price recorded in the last block of the preceding Adjustment Interval and records it in the block header. This computed EMA is used as the token price for fee calculations one Adjustment Interval into the future.

### EMA Formula

The EMA is frequently used in financial applications. It smooths out price volatility while weighting recent prices with higher impact than older prices giving a nice blend of protection from volatility and accuracy.

It is used instead of the average and median because:

- **Average**: Is susceptible to having outlier prices introduce volatility into the price calculation. When an outlier price enters and exits the sampling range it can disproportionally adjust the average price up or down leading to sudden changes in price which leave a sawtooth shape on the price graph.

- **Median**: Decreases the accuracy of the price prediction as it looks at the range as a whole leading to a wider margin of error.

The EMA can be calculated using the following formula:

{" "}

<div className="grid grid-cols-[1fr_6fr_6fr] gap-2   p-4 mt-5">
	<div className="col-span-3 px-4 py-2 bg-slate-800  text-white">
		<Latex>{`$$EMA_b = \\alpha \\cdot P_b + (1 - \\alpha) \\cdot EMA_{b-1}$$`}</Latex>
	</div>
	<div className="col-span-3 px-4 py-2 text-white flex flex-col items-start">
		<div key="1" className="mt-2 flex items-center">
			<Latex>{`$$EMA_b$$`}</Latex>
			<span className="ml-1">= the Exponential Moving Average at block b.</span>
		</div>
		<div key="2" className="mt-2 flex items-start">
			<Latex>{`$$\\alpha$$`}</Latex>
			<div className="flex flex-col items-start">
				<span className="ml-1">
					= the smoothing factor, calculated as <Latex>{`$\\frac{2}{(n+1)}$`}</Latex>, where n is the number
					of block prices.
				</span>
			</div>
		</div>
		<div key="3" className="mt-2 flex items-center">
			<Latex>{`$$P_b$$`}</Latex>
			<span className="ml-1">= the price at block b.</span>
		</div>
		<div key="4" className="mt-2 flex items-center">
			<Latex>{`$$EMA_{b-1}$$`}</Latex>
			<span className="ml-1">= the EMA at the previous block.</span>
		</div>
	</div>
</div>

### Example Calculation

{" "}

<div className="mt-5 ">
	<div className="flex flex-row  p-4 ">
		<div className="w-1/3 px-4 py-2 bg-slate-800 text-white flex items-center justify-center">
			Smoothing Factor
		</div>
		<div className="w-2/3 px-4 py-2 flex flex-col items-start">
			<Latex>{`$$\\alpha = \\frac{2}{(10 + 1)}$$`}</Latex>
			<div className="pl-4">
				<Latex>{`$$= \\frac{2}{11}$$`}</Latex>
			</div>
			<div className="pl-4">
				<Latex>{`$$\\approx 0.1818$$`}</Latex>
			</div>
		</div>
	</div>
	<div className="flex flex-row p-4 ">
		<div className="w-1/3 px-4 py-2 bg-slate-800 text-white flex items-center justify-center">
			EMA Formula
		</div>
		<div className="w-2/3 px-4 py-2 flex flex-col items-start">
			<Latex>{`$$EMA_1 = \\alpha \\cdot P_1 + (1 - \\alpha) \\cdot EMA_0$$`}</Latex>
			<Latex>{`$$EMA_0 = \\text{Genesis Price} = 1.00$$`}</Latex>
			<Latex>{`$$EMA_1 = 0.1818 \\cdot 1.01 + (1 - 0.1818) \\cdot 1.00$$`}</Latex>
			<Latex>{`$$EMA_1 = 0.183618 + 0.8182 = 1.001818$$`}</Latex>
			<Latex>{`$$EMA_1 = \\$1.001818$$`}</Latex>
		</div>
	</div>
</div>

This continues for each subsequent block, using the block's price and the previous block's EMA as part of the calculation. Upon reaching EMA9 (E9 in the diagram), the calculated EMA9 is recorded in the block for use at block height = 30.

The pricing model gives a fixed feel for X amount of data in USD (based on the current Annualized Cost). The current USD/$IRYS token price is used to convert that USD fee to $IRYS tokens. This keeps the USD price for storing data relatively consistent, regardless of fluctuations in the $IRYS token price.

For miners quoting a price to users for storage during the 3rd adjustment interval, they would take whatever price was higher between the E9 token price or the E19, so that even if a data storage transaction was posted in the 3rd Adjustment Interval it could still be confirmed in the 4th.

This ability to know what the $IRYS token will be priced at in the next adjustment interval is what allows for stable pricing. Without this mechanism, any time the price adjusted up all pending transactions would be dropped because they were now under-funded.

## Annualized Cost Adjustments

Irys's pricing model is updated annually to account for improvements (declines) in storage costs. The genesis block instantiates a pricing model with an annualized cost of storage, which serves as the basis for paying the future cost of storage. As each year passes, the expectation is to observe an improvement in the annualized cost of storage.

Approximately once a year (measured in block height), miners will have a 2-week window (also measured in block heights) to post their annualized cost of storing a partition in the headers of the blocks they produce. At the end of this two-week interval, the median cost is chosen as the basis for the pricing model in the upcoming year. These adjustments prevent the protocol from relying on the genesis block's pricing model, which may significantly overcharge in future years due to built-in safety margins.
