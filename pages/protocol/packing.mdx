import SequentialHashing from "@/components/SequentialHashing";
import Irys2dPacking from "@/components/Irys2dPacking";

import SimpleRiveViewer from "@/components/SimpleRiveViewer";

# Packing

<div className="w-full flex justify-center">
	<div className="w-full">
		<SimpleRiveViewer
			src="/diagrams/architecture/irys-docs-fast-2d-packing.riv"
			width={1920}
			height={1080}
			stateMachine="2D-Packing"
		/>
	</div>
</div>

## Overview

Packing involves adding a unique cryptographic fingerprint to stored data, and is used to prove to the network that miners are providing unique resources. This is essential to prevent adversarial participants from claiming to store multiple copies of data or offering large storage capacities while only providing a fraction of the claimed resources.

Irys introduces a novel approach to packing called 2D Packing, combined with staking and slashing mechanisms, resulting in fast and efficient storage verification. Irys' innovative approach reduces the risk of computational exploits by adversarial miners.

Our method:

- Scales horizontally across GPUs and ASICs without sacrificing security.
- Allows data to be unpacked on various devices (desktop, mobile, browser).
- Reduces the cost of onboarding miners and posting data, leading to lower storage fees.
- Combines with staking and slashing mechanisms to deter adversarial miners.
- Maintains cryptographic verifiability while prioritizing accessibility and cost-efficiency.
- Ensures a consistent packing time on a single CPU core, preventing parallel processing.
- Avoids computationally intensive methods like Zero Knowledge proofs and RandomX.

## Irys' 2D Packing

After storage capacity has been packed, miners must repeatedly prove to the protocol that the packed resources are available. On Irys, this is done using highly scalable 2D Packing.

2D Packing enforces a minimum amount of time to pack but allows it to scale horizontally across GPU and/or ASICS without sacrificing security.

The advantage is that it enables data to be unpacked from virtually any computing device (desktop, mobile, browser) while reducing the cost of onboarding miners to the network. It also reduces the cost of posting data on the network, which is passed on to users through lower storage fees.

Irys’ approach balances the need for cryptographic verifiability with the practical considerations of accessibility and computational & cost efficiency.

Here’s how it works:

| Step | Name               | Description                                                                                                                                                                                   |
| ---- | ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | Data Partitioning  | Data is logically partitioned into 16TB partitions, suitable for individual 16TB HDDs.                                                                                                        |
| 2    | Chunk Division     | Each partition is divided into 256KiB chunks, which are used during mining to produce hashes.                                                                                                 |
| 3    | Segment Creation   | Each 256KiB chunk is further divided into 32-byte segments containing packing entropy from a SHA-256 hash.                                                                                    |
| 4    | Sequential Hashing | Segments are hashed sequentially; each segment's hash input is the output of the previous segment. Sequential hashing establishes a minimum packing time by requiring 8,192 hashes per chunk. |
| 5    | Layered Hashing    | Repeated sequential hashing creates multiple layers of segments, storing the final layer in the chunk.                                                                                        |

## Advantages

Irys' 2D packing runs in parallel, enabling many chunks to be packed simultaneously.

Individual chunks always take a safe amount of time to pack; reading packed data is always vastly more economical than packing it on demand.

Other advantages of 2D Packing include not needing to re-pack capacity once data is assigned. The 2D Packing fingerprint can be applied to empty capacity. This allows Irys to reward miners for packing empty capacity, when that capacity is needed for data it doesn’t have to be repacked. Instead, data is XOR’d into the existing packing making ingress of data to packed capacity cheap and fast.

## Trade-Offs

A side effect of having 2D Packing (and unpacking) take a safe amount of time is that this safe time is also the minimum amount of time miners will need to fully validate a new block. This means the network's block time cannot be shorter than the “safe minimum time” encoded in 2D Packing. This is not expected to be an issue as the safe minimum time is ~3s and PoW block times tend to be 3-4x that long due to other factors.
